[include machine.cfg]
[include mainsail.cfg]
[include macro.cfg]
[include shaketune.cfg]
[include stepper.cfg]
[include tmc.cfg]
[include TEST_SPEED.cfg]
[include timelapse.cfg]
[include fan.cfg]
[include neopixel.cfg]
[include autotune.cfg]
[include shell_command.cfg]
[include klipper_backup.cfg]
[skew_correction]
[exclude_object]
[force_move]
enable_force_move: True
[save_variables]
filename: ~/printer_data/config/variables.cfg
[gcode_arcs]                       
resolution: 0.1 #1.0
[idle_timeout]
gcode: _IDLE_TIMEOUT
timeout: 108000
[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT


#############################################################################
###			ADXL
#############################################################################

[resonance_tester]
accel_chip: adxl345
probe_points:
    175, 175, 30
accel_per_hz: 50
min_freq: 1
max_freq: 200 #100
max_smoothing: 0.5
hz_per_sec: 0.5
sweeping_period: 0.0

[input_shaper]
# y -> MZV @ 44.8 Hz (with a damping ratio of 0.040)
# x -> For performance: MZV @ 60.4 Hz (with a damping ratio of 0.046)

shaper_type_y: mzv
shaper_freq_y: 44.8
damping_ratio_y: 0.040
shaper_type_x: mzv
shaper_freq_x: 60.4
damping_ratio_x: 0.046

#############################################################################
###			TEMPERATURES
#############################################################################

[thermistor thermistor_extruder]
temperature1:25
resistance1:110000
temperature2:100
resistance2:7008
temperature3:220
resistance3:435

[thermistor thermistor_bed]
temperature1:25
resistance1:100000
temperature2:50
resistance2:18085.4
temperature3:100
resistance3:5362.6

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[temperature_probe btt_eddy]
sensor_type: Generic 3950
sensor_pin: eddy:gpio26
horizontal_move_z: 2

#############################################################################
###			HEATERS
#############################################################################

[heater_bed]
heater_pin:PA1
sensor_type: thermistor_bed
sensor_pin: PF3
max_power: 0.90
min_temp: 5
max_temp: 105
pwm_cycle_time: 0.3
#control: pid
#pid_kp: 66.381
#pid_ki: 1.203
#pid_kd: 916.057

[verify_heater heater_bed]      
max_error: 120                
check_gain_time:40           
hysteresis: 5                
heating_gain: 2

[verify_heater extruder]      
max_error: 200
check_gain_time:30
hysteresis: 10
heating_gain: 2

#############################################################################
###			PRINTER
#############################################################################

[printer]
kinematics: corexy           
max_velocity: 600 #700            
max_accel: 10000 #30000 #40000        
minimum_cruise_ratio: 0.5 #0.33
max_z_velocity: 26 #25 #20
max_z_accel: 500             
square_corner_velocity: 5.0  

#############################################################################
###			PROBE
#############################################################################

[probe_eddy_current btt_eddy]
sensor_type: ldc1612
i2c_mcu: eddy
i2c_bus: i2c0f
x_offset: -17
y_offset: 10
z_offset: 1.5
speed: 3.0
lift_speed: 20

#############################################################################
###			MESH, LEVEL, Calibrate
#############################################################################

[bed_mesh]
speed: 400 #200
horizontal_move_z: 2
mesh_min: 20,25
mesh_max: 333,325
probe_count: 60,60 #20,20
adaptive_margin: 10
algorithm: bicubic
bicubic_tension: 0.2 #0.3
fade_start: 0.4 #0
fade_end: 10
fade_target: 0

# For the mesh dimensions below, the coordinates need to be reachable by the center of the probe. To calculate coordinates that will work, use the formula below:
# mesh x min = position_min_x + greater_of (15mm or x_offset) <--- in this term, only consider the x offset if it is positive, ignore if negative.
# mesh y min = position_min_y + greater_of (15mm or y_offset) <--- in this term, only consider the y offset if it is positive, ignore if negative.
# mesh x max = position_max_x - greater_of (15mm or |x_offset|) <--- in this term, only consider the x offset if it is negative, ignore if positive.
# mesh y max = position_max_y - greater_of (15mm or |y_offset|) <--- in this term, only consider the y offset if it is negative, ignore if positive.
# Example: Consider that you have a 300 x 300 bed with the max x and y positions being 300 and the min being 0. Your probe offsets are -20 for X and 10 for Y
# For mesh x min we ignore the x offset term because it is negative. Therefore mesh x min = 15
# For mesh y min we do not ignore the y offset term because it is positive but it is less than 15 so we use 15. Therefore mesh y min = 15
# For mesh x max we do not ignore the x offset term because it is negative. It is also greater than 15. Therefore mesh x max = 280
# For mesh y max we ignore the y offset term because it is positive but it is less than 15 so we use 15. Therefore mesh y max = 285
# The final result would be mesh_min: 15, 15 mesh_max: 280, 285

[quad_gantry_level]          
gantry_corners:              
    -60,-10
    410,420
points:
    36,10
    36,320
    346,320
    346,10
speed: 500        
horizontal_move_z: 5
retry_tolerance: 0.0075
retries: 7
max_adjust: 10  

#############################################################################
###			EXTRUDER
#############################################################################
[extruder]
step_pin: extra_mcu:PA8   
dir_pin: extra_mcu:PB8    
enable_pin:!extra_mcu: PB11   
rotation_distance: 6.745 #6.5 
microsteps: 128 #16                
full_steps_per_rotation: 200 
nozzle_diameter: 0.400        
filament_diameter: 1.75  
max_extrude_only_distance: 200.0
max_extrude_cross_section: 45.0
heater_pin: extra_mcu:PB9  
sensor_type: thermistor_extruder  
pullup_resistor: 11500
sensor_pin: extra_mcu:PA5  
min_temp: 5                  
max_temp: 308        
max_power: 0.95
min_extrude_temp: 185
#control: pid
#pid_kp: 22.410
#pid_ki: 2.298
#pid_kd: 54.624
pressure_advance: 0.025       
pressure_advance_smooth_time: 0.020

[filament_switch_sensor filament_sensor]
pause_on_runout: True
event_delay: 3.0
pause_delay: 5
switch_pin: ^!PG14
runout_gcode: RUNOUT

#############################################################################
###			LED
#############################################################################

[led main_led]
white_pin: PD12
cycle_time: 0.01 #5
initial_WHITE: 0.15

#############################################################################
###			PINS
#############################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,
    
    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

    
#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.049956:3165386.826,0.090107:3164906.537,0.130025:3164430.920,
#*# 	0.169943:3163953.735,0.210094:3163481.138,0.250012:3163024.024,
#*# 	0.289929:3162567.394,0.330081:3162120.266,0.369998:3161694.329,
#*# 	0.409916:3161256.190,0.450068:3160813.821,0.489985:3160404.666,
#*# 	0.529903:3160003.838,0.570054:3159596.968,0.609972:3159204.216,
#*# 	0.649890:3158822.434,0.690041:3158413.766,0.729959:3158036.640,
#*# 	0.770110:3157684.848,0.810028:3157321.068,0.849946:3156969.624,
#*# 	0.890097:3156598.233,0.930015:3156262.048,0.969933:3155942.168,
#*# 	1.010084:3155599.399,1.050002:3155289.509,1.089920:3154977.928,
#*# 	1.130071:3154641.994,1.169989:3154336.782,1.209907:3154023.185,
#*# 	1.250058:3153721.059,1.289976:3153417.244,1.329893:3153143.296,
#*# 	1.370045:3152867.262,1.409962:3152571.840,1.450114:3152286.215,
#*# 	1.490032:3152038.766,1.529949:3151752.543,1.570101:3151521.899,
#*# 	1.610018:3151236.615,1.649936:3150990.845,1.690087:3150745.164,
#*# 	1.730005:3150510.480,1.769923:3150273.776,1.810074:3150011.776,
#*# 	1.849992:3149801.638,1.889910:3149569.119,1.930061:3149341.534,
#*# 	2.089966:3148487.076,2.129884:3148287.443,2.170035:3148096.710,
#*# 	2.209953:3147907.436,2.250104:3147693.474,2.290022:3147488.961,
#*# 	2.329940:3147299.949,2.370091:3147117.466,2.410009:3146931.280,
#*# 	2.449927:3146759.979,2.490078:3146579.705,2.529996:3146393.757,
#*# 	2.569913:3146228.807,2.610065:3146043.415,2.649983:3145881.785,
#*# 	2.689900:3145709.937,2.730052:3145560.939,2.769969:3145382.357,
#*# 	2.809887:3145236.889,2.850038:3145058.848,2.889956:3144922.296,
#*# 	2.930108:3144748.752,2.970025:3144604.610,3.009943:3144487.876,
#*# 	3.050094:3144323.253,3.090012:3144180.804,3.129930:3144054.020,
#*# 	3.170081:3143914.946,3.209999:3143773.205,3.249917:3143634.679,
#*# 	3.290068:3143505.564,3.329986:3143385.503,3.369904:3143243.305,
#*# 	3.410055:3143123.567,3.449973:3142981.571,3.489891:3142850.125,
#*# 	3.530042:3142739.528,3.569960:3142632.336,3.610111:3142515.863,
#*# 	3.650029:3142376.558,3.689947:3142289.976,3.730098:3142160.615,
#*# 	3.770016:3142059.629,3.809933:3141931.715,3.850085:3141834.574,
#*# 	3.890003:3141738.867,3.929920:3141620.003,3.970072:3141516.480,
#*# 	4.009989:3141442.347,4.049907:3141306.705
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 39.843888
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.104641, 0.077969, 0.020389, -0.015016, -0.057223, -0.082706, -0.087598, -0.109625, -0.120887, -0.126518, -0.152148, -0.169945, -0.197962, -0.202235, -0.199030, -0.167709, -0.132899, -0.098892, -0.055689, -0.018846
#*# 	0.129888, 0.096344, 0.040435, 0.001360, -0.033736, -0.049618, -0.054378, -0.071457, -0.084603, -0.098354, -0.120533, -0.132324, -0.169945, -0.166778, -0.188022, -0.183423, -0.179615, -0.152962, -0.097548, -0.088678
#*# 	0.117033, 0.103473, 0.059594, 0.025428, 0.002814, -0.001971, -0.000046, -0.018850, -0.042103, -0.062377, -0.073582, -0.087679, -0.113379, -0.134344, -0.165086, -0.173809, -0.168116, -0.161482, -0.120887, -0.089221
#*# 	0.162857, 0.113928, 0.066897, 0.025765, 0.018255, 0.015013, 0.018769, -0.008754, -0.015873, -0.033734, -0.049618, -0.068611, -0.092980, -0.108101, -0.141414, -0.164511, -0.184817, -0.189416, -0.167541, -0.174417
#*# 	0.117033, 0.111175, 0.075794, 0.056127, 0.046183, 0.035233, 0.042761, 0.023636, 0.016078, 0.004856, -0.027403, -0.047633, -0.075479, -0.101174, -0.126518, -0.159026, -0.163366, -0.195825, -0.195825, -0.194432
#*# 	0.167588, 0.114450, 0.096344, 0.081517, 0.065343, 0.065343, 0.048828, 0.043310, 0.034684, 0.034139, 0.001997, -0.021827, -0.046023, -0.080809, -0.122057, -0.135354, -0.161482, -0.194431, -0.211767, -0.253947
#*# 	0.124028, 0.106335, 0.099565, 0.094488, 0.090703, 0.088729, 0.071806, 0.069173, 0.060555, 0.036602, 0.009639, -0.001540, -0.041680, -0.073762, -0.106809, -0.132324, -0.165086, -0.193689, -0.225055, -0.251567
#*# 	0.144662, 0.103473, 0.091747, 0.091747, 0.077811, 0.071765, 0.073379, 0.066300, 0.054805, 0.026833, 0.028496, -0.002743, -0.038085, -0.075479, -0.098716, -0.138384, -0.173809, -0.208645, -0.239366, -0.314184
#*# 	0.081515, 0.091750, 0.085303, 0.090056, 0.094008, 0.063976, 0.052478, 0.063427, 0.046183, 0.036238, 0.008528, -0.019842, -0.057223, -0.097141, -0.123703, -0.165086, -0.191227, -0.227100, -0.260615, -0.274131
#*# 	0.158545, 0.143703, 0.117207, 0.122190, 0.121842, 0.107705, 0.099888, 0.096829, 0.098761, 0.063427, 0.046183, 0.020946, -0.023811, -0.051535, -0.097447, -0.126518, -0.143873, -0.192620, -0.215411, -0.272850
#*# 	0.146065, 0.169048, 0.177267, 0.181742, 0.163678, 0.150853, 0.144229, 0.146456, 0.116685, 0.099565, 0.083532, 0.053846, 0.023123, -0.033173, -0.062377, -0.071457, -0.128804, -0.156571, -0.192635, -0.191227
#*# 	0.226442, 0.213221, 0.215354, 0.199996, 0.195590, 0.182069, 0.167337, 0.162208, 0.139242, 0.130453, 0.103958, 0.096344, 0.046183, -0.001885, -0.025422, -0.048626, -0.077837, -0.118071, -0.147478, -0.177013
#*# 	0.216405, 0.229157, 0.235667, 0.223797, 0.215863, 0.197354, 0.192062, 0.175031, 0.162208, 0.140554, 0.120355, 0.094812, 0.046732, 0.020946, -0.018281, -0.033734, -0.066712, -0.107747, -0.126518, -0.100590
#*# 	0.290770, 0.266986, 0.254065, 0.240544, 0.221694, 0.220269, 0.218168, 0.195590, 0.177104, 0.162581, 0.141473, 0.109036, 0.072011, 0.040435, 0.015355, -0.015873, -0.054378, -0.103307, -0.099957, -0.106805
#*# 	0.297178, 0.303586, 0.293664, 0.273145, 0.262312, 0.259233, 0.229593, 0.218505, 0.207929, 0.185162, 0.164897, 0.138718, 0.104644, 0.058223, 0.034684, 0.013392, -0.021827, -0.046023, -0.055326, -0.009139
#*# 	0.375776, 0.333251, 0.311982, 0.276812, 0.274440, 0.254761, 0.238454, 0.220606, 0.213221, 0.202133, 0.171974, 0.159525, 0.111174, 0.079179, 0.035413, 0.023634, -0.024238, -0.039695, -0.036714, -0.021827
#*# 	0.380264, 0.351968, 0.324491, 0.305188, 0.285964, 0.276347, 0.248898, 0.219519, 0.232222, 0.214643, 0.178978, 0.159766, 0.109036, 0.096344, 0.063427, 0.037561, -0.002654, -0.013886, -0.000428, 0.051204
#*# 	0.500055, 0.414774, 0.355485, 0.352294, 0.319451, 0.314597, 0.290769, 0.269936, 0.246806, 0.224302, 0.210575, 0.189436, 0.154560, 0.120355, 0.090058, 0.069541, 0.040437, 0.016078, 0.034688, 0.065755
#*# 	0.543816, 0.472800, 0.408046, 0.372232, 0.357343, 0.340624, 0.314914, 0.290767, 0.273143, 0.253698, 0.227319, 0.214643, 0.182233, 0.136489, 0.113928, 0.088725, 0.065343, 0.057682, 0.079502, 0.145012
#*# 	0.662408, 0.585369, 0.504422, 0.449591, 0.416408, 0.383630, 0.365793, 0.340624, 0.328806, 0.300381, 0.273946, 0.249391, 0.216744, 0.187199, 0.157326, 0.138718, 0.108551, 0.100933, 0.133206, 0.149739
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 332.92999999999995
#*# min_y = 25.0
#*# max_y = 324.8199999999999
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = -0.0006010428404623171
#*# xz_skew = -0.0021001165151680544
#*# yz_skew = 0.0007000434360676134
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 25.306
#*# pid_ki = 3.276
#*# pid_kd = 48.872
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 89.042
#*# pid_ki = 7.511
#*# pid_kd = 90.888
